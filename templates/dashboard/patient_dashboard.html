{% extends 'base.html' %} {% load static %} {% block title %}Patient Dashboard{% endblock %} {% block content %}
<link rel="stylesheet" href="{% static 'css/patient-dashboard.css' %}" />
<link rel="stylesheet" href="{% static 'css/toast-message.css' %}" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />

<main class="dashboard-wrapper">
    <div class="dashboard-container">
        <aside class="sidebar">
            <nav>
                <ul>
                    <li>
                        <a id="nav-overview" href="#overview" class="sidebar-nav-item active"> <span class="icon">üè†</span> T·ªïng quan </a>
                    </li>
                    <li>
                        <a id="nav-profile" href="#profile" class="sidebar-nav-item"> <span class="icon">üë§</span> H·ªì s∆° c√° nh√¢n </a>
                    </li>
                    <li>
                        <a id="nav-appointments" href="#appointments" class="sidebar-nav-item"> <span class="icon">üìÖ</span> L·ªãch kh√°m </a>
                    </li>
                    <li>
                        <a id="nav-notifications" href="#notifications" class="sidebar-nav-item"> <span class="icon">üîî</span> Th√¥ng b√°o </a>
                    </li>
                    <li>
                        <a id="nav-stats" href="#stats" class="sidebar-nav-item"> <span class="icon">üìä</span> Th·ªëng k√™ </a>
                    </li>
                    <li>
                        <a id="nav-messages" href="#messages" class="sidebar-nav-item"> <span class="icon">üí¨</span> Tin nh·∫Øn </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <section class="content">
            <div id="panel-overview" class="panel">
                <div class="card">
                    <h1>Xin ch√†o, {{ patient.user.full_name|default:request.user.full_name }}</h1>

                    <div class="card-section">
                        <div class="section-header">
                            <h2>L·ªãch h·∫πn s·∫Øp t·ªõi</h2>
                            <a href="#appointments" class="btn-primary" id="view-all-appointments-overview">Xem t·∫•t c·∫£</a>
                        </div>
                        <div id="appointments-table" class="table">
                            <div class="row header">
                                <div>Ng√†y</div>
                                <div>Gi·ªù</div>
                                <div>B√°c sƒ©</div>
                                <div>Tr·∫°ng th√°i</div>
                            </div>
                            <div id="appointments-loading" class="skeleton-table">
                                <div class="row shimmer">
                                    <div></div>
                                    <div></div>
                                    <div></div>
                                    <div></div>
                                </div>
                                <div class="row shimmer">
                                    <div></div>
                                    <div></div>
                                    <div></div>
                                    <div></div>
                                </div>
                            </div>
                            <div id="appointments-content" class="table-body hidden"></div>
                            <div id="appointments-error" class="error-message hidden"></div>
                        </div>
                    </div>

                    <div class="flex-row">
                        <div class="card-section flex-item">
                            <div class="section-header">
                                <h2>H·ªì s∆° c√° nh√¢n</h2>
                            </div>
                            <div id="profile-summary" class="skeleton-bars">
                                <div class="bar w-75 shimmer"></div>
                                <div class="bar w-60 shimmer"></div>
                                <div class="bar w-50 shimmer"></div>
                            </div>
                            <div id="profile-error-overview" class="error-message hidden"></div>
                        </div>

                        <div class="card-section flex-item">
                            <div class="section-header">
                                <h2>Th·ªëng k√™ l·ªãch kh√°m</h2>
                                <a href="#stats" class="btn-primary" id="view-stats-overview">Xem chi ti·∫øt</a>
                            </div>
                            <div id="stats-overview"></div>
                            <div id="stats-error-overview" class="error-message hidden"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="panel-profile" class="panel hidden">
                <div class="card">
                    <div class="profile-header">
                        <div class="profile-pic"></div>
                        <div class="profile-info">
                            <h1 id="profile-name"></h1>
                            <p class="role">B·ªánh nh√¢n</p>
                            <a href="#" id="btn-edit-profile" class="btn-primary">Ch·ªânh s·ª≠a h·ªì s∆°</a>
                        </div>
                    </div>
                    <div class="profile-details">
                        <div>
                            <h2>Th√¥ng tin c∆° b·∫£n</h2>
                            <ul id="basic-info"></ul>
                        </div>
                        <div>
                            <h2>Th√¥ng tin b·ªï sung</h2>
                            <ul id="extra-info"></ul>
                        </div>
                    </div>
                    <div id="profile-error" class="error-message hidden"></div>
                </div>
            </div>

            <div id="panel-appointments" class="panel hidden">
                <div class="card">
                    <div class="section-header">
                        <h1>L·ªãch h·∫πn c·ªßa t√¥i</h1>
                        <a href="/appointments" class="btn-primary" id="btn-book-new">ƒê·∫∑t l·ªãch m·ªõi</a>
                    </div>
                    <div class="filter-section">
                        <div class="filter-group">
                            <label for="status-filter">Tr·∫°ng th√°i:</label>
                            <select id="status-filter">
                                <option value="all">T·∫•t c·∫£</option>
                                <option value="CONFIRMED">ƒê√£ x√°c nh·∫≠n</option>
                                <option value="PENDING">Ch·ªù x√°c nh·∫≠n</option>
                                <option value="COMPLETED">Ho√†n th√†nh</option>
                                <option value="CANCELLED">ƒê√£ h·ªßy</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="start-date-filter">T·ª´ ng√†y:</label>
                            <input type="text" id="start-date-filter" placeholder="dd/mm/yyyy" />
                        </div>
                        <div class="filter-group">
                            <label for="end-date-filter">ƒê·∫øn ng√†y:</label>
                            <input type="text" id="end-date-filter" placeholder="dd/mm/yyyy" />
                        </div>
                        <button id="apply-filters" class="btn-primary">√Åp d·ª•ng</button>
                        <button id="clear-filters" class="btn-secondary">X√≥a b·ªô l·ªçc</button>
                    </div>
                    <div id="all-appointments-table" class="table">
                        <div class="row header">
                            <div>Ng√†y</div>
                            <div>Gi·ªù</div>
                            <div>B√°c sƒ©</div>
                            <div>Tr·∫°ng th√°i</div>
                            <div>Thao t√°c</div>
                        </div>
                        <div id="all-appointments-loading" class="skeleton-table">
                            <div class="row shimmer">
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                            </div>
                            <div class="row shimmer">
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                            </div>
                        </div>
                        <div id="all-appointments-content" class="table-body hidden"></div>
                        <div id="all-appointments-error" class="error-message hidden"></div>
                    </div>
                </div>
            </div>

            <div id="panel-notifications" class="panel hidden">
                <div class="card">
                    <div class="section-header">
                        <h1>Th√¥ng b√°o</h1>
                        <a href="#" class="btn-secondary btn-small" id="btn-refresh-notifications">L√†m m·ªõi</a>
                    </div>
                    <div id="notifications-table" class="table">
                        <div class="row header">
                            <div>N·ªôi dung</div>
                            <div>Th·ªùi gian</div>
                            <div>Lo·∫°i</div>
                            <div>Tr·∫°ng th√°i</div>
                        </div>
                        <div id="notifications-loading" class="skeleton-table">
                            <div class="row shimmer">
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                            </div>
                            <div class="row shimmer">
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                            </div>
                        </div>
                        <div id="notifications-content" class="table-body hidden"></div>
                        <div id="notifications-error" class="error-message hidden"></div>
                    </div>
                </div>
            </div>

            <div id="panel-stats" class="panel hidden">
                <div class="card">
                    <h1>Th·ªëng k√™</h1>
                    <div id="stats-full" class="stats-grid">
                        <div class="bar w-75 shimmer"></div>
                        <div class="bar w-60 shimmer"></div>
                        <div class="bar w-50 shimmer"></div>
                    </div>
                    <div id="stats-error" class="error-message hidden"></div>
                </div>
            </div>

            <div id="panel-messages" class="panel hidden">
                <div class="card">
                    <h1>Tin nh·∫Øn</h1>
                    <p>Ch·ª©c nƒÉng ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn...</p>
                </div>
            </div>

            <div id="loadingOverlay" class="loading-overlay">
                <div class="spinner"></div>
                <div class="loading-text">ƒêang x·ª≠ l√Ω...</div>
                <div class="loading-subtext">Qu√° tr√¨nh n√†y c√≥ th·ªÉ m·∫•t m·ªôt ch√∫t th·ªùi gian.</div>
            </div>

            <div id="ToastContainer" class="toast-container"></div>
        </section>
        <div id="edit-profile-modal" class="modal" style="display: none">
            <div class="modal-content" style="max-width: 700px">
                <form id="edit-profile-form" data-validate-form>
                    <h2>Ch·ªânh s·ª≠a H·ªì s∆° c√° nh√¢n</h2>
        
                    <div class="profile-edit-grid">
                        <div class="form-group">
                            <label for="edit-full-name">H·ªç v√† t√™n</label>
                            <input
                                type="text"
                                id="edit-full-name"
                                name="full_name"
                                data-validate="name"
                                required
                            />
                            <small class="error-message" id="full-name-error"></small>
                        </div>
        
                        <div class="form-group">
                            <label for="edit-phone-number">S·ªë ƒëi·ªán tho·∫°i</label>
                            <input
                                type="tel"
                                id="edit-phone-number"
                                name="phone_number"
                                data-validate="phone"
                                required
                            />
                            <small class="error-message" id="phone-error"></small>
                        </div>
        
                        <div class="form-group">
                            <label for="edit-dob">Ng√†y sinh</label>
                            <input
                                type="text"
                                id="edit-dob"
                                name="dob"
                                data-validate="date"
                                placeholder="dd/mm/yyyy"
                                required
                            />
                            <small class="error-message" id="dob-error"></small>
                        </div>
        
                        <div class="form-group">
                            <label for="edit-gender">Gi·ªõi t√≠nh</label>
                            <select
                                id="edit-gender"
                                name="gender"
                                data-validate="select"
                                required
                            >
                                <option value="">-- Ch·ªçn gi·ªõi t√≠nh --</option>
                                <option value="MALE">Nam</option>
                                <option value="FEMALE">N·ªØ</option>
                                <option value="OTHER">Kh√°c</option>
                            </select>
                            <small class="error-message" id="gender-error"></small>
                        </div>
        
                        <div class="form-group full-width">
                            <label>ƒê·ªãa ch·ªâ</label>
                            <div class="address-selects">
                                <select id="city" name="city" data-validate="select" required>
                                    <option value="">-- Ch·ªçn T·ªânh/Th√†nh ph·ªë --</option>
                                </select>
                                <select id="district" name="district" data-validate="select" required>
                                    <option value="">-- Ch·ªçn Qu·∫≠n/Huy·ªán --</option>
                                </select>
                                <select id="ward" name="ward" data-validate="select" required>
                                    <option value="">-- Ch·ªçn Ph∆∞·ªùng/X√£ --</option>
                                </select>
                            </div>
                            <div class="error-inline-group">
                                <small class="error-message-inline" id="city-error"></small>
                                <small class="error-message-inline" id="district-error"></small>
                                <small class="error-message-inline" id="ward-error"></small>
                            </div>
                        </div>
        
                        <div class="form-group full-width">
                            <label for="edit-address-detail">ƒê·ªãa ch·ªâ chi ti·∫øt (s·ªë nh√†, t√™n ƒë∆∞·ªùng)</label>
                            <input
                                type="text"
                                id="edit-address-detail"
                                name="address_detail"
                                data-validate="address_detail"
                                required
                            />
                            <small class="error-message" id="address-error"></small>
                        </div>
        
                        <div class="form-group">
                            <label for="edit-email">Email</label>
                            <input
                                type="email"
                                id="edit-email"
                                name="email"
                                data-validate="email"
                                required
                            />
                            <small class="error-message" id="email-error"></small>
                        </div>
        
                        <hr class="full-width" />
        
                        <div class="form-group">
                            <label for="edit-insurance-no">M√£ BHYT</label>
                            <input
                                type="text"
                                id="edit-insurance-no"
                                name="insurance_no"
                                data-validate="insurance_no"
                            />
                            <small class="error-message" id="insurance-error"></small>
                        </div>
        
                        <div class="form-group">
                            <label for="edit-id-number">S·ªë CMND/CCCD</label>
                            <input
                                type="text"
                                id="edit-id-number"
                                name="id_number"
                                data-validate="id"
                            />
                            <small class="error-message" id="id-error"></small>
                        </div>
        
                        <div class="form-group">
                            <label for="edit-ethnicity">D√¢n t·ªôc</label>
                            <input
                                type="text"
                                id="edit-ethnicity"
                                name="ethnicity"
                                data-validate="ethnicity"
                            />
                            <small class="error-message" id="ethnicity-error"></small>
                        </div>
        
                        <div class="form-group">
                            <label for="edit-occupation">Ngh·ªÅ nghi·ªáp</label>
                            <input
                                type="text"
                                id="edit-occupation"
                                name="occupation"
                                data-validate="occupation"
                            />
                            <small class="error-message" id="occupation-error"></small>
                        </div>
                    </div>
        
                    <div class="modal-actions">
                        <button
                            type="button"
                            id="edit-profile-cancel-btn"
                            class="btn-close"
                        >
                            H·ªßy
                        </button>
                        <button type="submit" class="btn-primary">L∆∞u thay ƒë·ªïi</button>
                    </div>
                </form>
            </div>
        </div>
        
        

        <div id="cancelModal" class="modal" style="display: none">
            <div class="modal-content">
                <h2>X√°c nh·∫≠n h·ªßy l·ªãch h·∫πn</h2>
                <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën h·ªßy l·ªãch h·∫πn n√†y kh√¥ng?</p>
                <div class="modal-actions">
                    <button id="cancelConfirmBtn" class="btn-cancel">H·ªßy</button>
                    <button id="cancelCloseBtn" class="btn-close">ƒê√≥ng</button>
                </div>
            </div>
        </div>
        <div id="errorModal" class="modal" style="display: none">
            <div class="modal-content">
                <h2>Th√¥ng b√°o</h2>
                <p id="errorModalMessage"></p>
                <div class="modal-actions">
                    <button id="errorModalCloseBtn" class="btn-close">ƒê√≥ng</button>
                </div>
            </div>
        </div>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/vn.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script type="module" src="{% static 'js/dashboard/patient/patient-dashboard.js' %}"></script>
{% endblock %}