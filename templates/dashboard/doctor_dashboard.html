{% extends 'base.html' %} {% load static %} {% block title %}Doctor Dashboard{% endblock %} {% block content %}
<link rel="stylesheet" href="{% static 'css/doctor-dashboard.css' %}" />
<link rel="stylesheet" href="{% static 'css/toast-message.css' %}" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />

<main class="dashboard-wrapper">
    <div class="dashboard-container">
        <aside class="sidebar">
            <nav>
                <ul>
                    <li>
                        <a id="nav-overview" href="#overview" class="sidebar-nav-item active"><span class="icon">üè†</span> T·ªïng quan</a>
                    </li>
                    <li>
                        <a id="nav-profile" href="#profile" class="sidebar-nav-item"><span class="icon">üë§</span> H·ªì s∆° c√° nh√¢n</a>
                    </li>
                    <li>
                        <a id="nav-appointments" href="#appointments" class="sidebar-nav-item"><span class="icon">üìÖ</span> L·ªãch kh√°m</a>
                    </li>
                    <li>
                        <a id="nav-notifications" href="#notifications" class="sidebar-nav-item"><span class="icon">üîî</span> Th√¥ng b√°o</a>
                    </li>
                    <li>
                        <a id="nav-availability" href="#availability" class="sidebar-nav-item"><span class="icon">‚è∞</span> L·ªãch l√†m vi·ªác</a>
                    </li>
                    <li>
                        <a id="nav-days-off" href="#days-off" class="sidebar-nav-item"><span class="icon">‚è≥</span> Ng√†y ngh·ªâ</a>
                    </li>
                    <li>
                        <a id="nav-stats" href="#stats" class="sidebar-nav-item"><span class="icon">üìä</span> Th·ªëng k√™</a>
                    </li>
                    <li>
                        <a id="nav-messages" href="#messages" class="sidebar-nav-item"><span class="icon">üí¨</span> Tin nh·∫Øn</a>
                    </li>
                </ul>
            </nav>
        </aside>

        <section class="content">
            <div id="panel-overview" class="panel">
                <div class="card">
                    <h1>Xin ch√†o, {{ doctor.user.full_name|default:request.user.full_name }}</h1>

                    <div class="card-section">
                        <div class="section-header">
                            <h2>L·ªãch h·∫πn s·∫Øp t·ªõi</h2>
                            <a href="#appointments" class="btn-primary" id="view-all-appointments-overview">Xem t·∫•t c·∫£</a>
                        </div>
                        <div id="appointments-table" class="table table-overview">
                            <div class="row header">
                                <div>Ng√†y</div>
                                <div>Gi·ªù</div>
                                <div>B·ªánh nh√¢n</div>
                                <div>Tr·∫°ng th√°i</div>
                                <div>Thao t√°c</div>
                            </div>
                            <div id="appointments-loading" class="skeleton-table">
                                <div class="row shimmer">
                                    <div></div>
                                    <div></div>
                                    <div></div>
                                    <div></div>
                                </div>
                                <div class="row shimmer">
                                    <div></div>
                                    <div></div>
                                    <div></div>
                                    <div></div>
                                </div>
                            </div>
                            <div id="appointments-content" class="table-body hidden"></div>
                            <div id="appointments-error" class="error-message hidden"></div>
                        </div>
                    </div>

                    <div class="flex-row">
                        <div class="card-section flex-item">
                            <div class="section-header">
                                <h2>H·ªì s∆° c√° nh√¢n</h2>
                            </div>
                            <div id="profile-summary" class="skeleton-bars">
                                <div class="bar w-75 shimmer"></div>
                                <div class="bar w-60 shimmer"></div>
                                <div class="bar w-50 shimmer"></div>
                            </div>
                            <div id="profile-error-overview" class="error-message hidden"></div>
                        </div>

                        <div class="card-section flex-item">
                            <div class="section-header">
                                <h2>Th·ªëng k√™ l·ªãch kh√°m</h2>
                                <a href="#stats" class="btn-primary" id="view-stats-overview">Xem chi ti·∫øt</a>
                            </div>
                            <div id="stats-overview"></div>
                            <div id="stats-error-overview" class="error-message hidden"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="panel-profile" class="panel hidden">
                <div class="card">
                    <div class="profile-header">
                        <div class="profile-pic"></div>
                        <div class="profile-info">
                            <h1 id="profile-name"></h1>
                            <p class="role">B√°c sƒ©</p>
                            <a href="#" id="btn-edit-profile" class="btn-primary">Ch·ªânh s·ª≠a h·ªì s∆°</a>
                        </div>
                    </div>
                    <div class="profile-details">
                        <div>
                            <h2>Th√¥ng tin c∆° b·∫£n</h2>
                            <ul id="basic-info"></ul>
                        </div>
                        <div>
                            <h2>Th√¥ng tin b·ªï sung</h2>
                            <ul id="extra-info"></ul>
                        </div>
                    </div>
                    <div id="profile-error" class="error-message hidden"></div>
                </div>
            </div>

            <div id="panel-appointments" class="panel hidden">
                <div class="card">
                    <div class="section-header">
                        <h1>L·ªãch h·∫πn c·ªßa t√¥i</h1>
                        <div>
                            <a href="#appointments" id="btn-refresh-appointments" class="btn-secondary btn-secondary">L√†m m·ªõi</a>
                        </div>
                    </div>
                    <div class="filter-section">
                        <div class="filter-group">
                            <label for="status-filter">Tr·∫°ng th√°i:</label>
                            <select id="status-filter">
                                <option value="all">T·∫•t c·∫£</option>
                                <option value="CONFIRMED">ƒê√£ x√°c nh·∫≠n</option>
                                <option value="PENDING">Ch·ªù x√°c nh·∫≠n</option>
                                <option value="COMPLETED">Ho√†n th√†nh</option>
                                <option value="CANCELLED">ƒê√£ h·ªßy</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="start-date-filter">T·ª´ ng√†y:</label>
                            <input type="text" id="start-date-filter" placeholder="dd / mm / yyyy" />
                        </div>
                        <div class="filter-group">
                            <label for="end-date-filter">ƒê·∫øn ng√†y:</label>
                            <input type="text" id="end-date-filter" placeholder="dd / mm / yyyy" />
                        </div>
                        <button id="apply-filters" class="btn-primary">√Åp d·ª•ng</button>
                        <button id="clear-filters" class="btn-secondary">X√≥a b·ªô l·ªçc</button>
                    </div>
                    <div id="all-appointments-table" class="table">
                        <div class="row header">
                            <div>Ng√†y</div>
                            <div>Gi·ªù</div>
                            <div>B·ªánh nh√¢n</div>
                            <div>Tr·∫°ng th√°i</div>
                            <div>Thao t√°c</div>
                        </div>
                        <div id="all-appointments-loading" class="skeleton-table">
                            <div class="row shimmer">
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                            </div>
                            <div class="row shimmer">
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                            </div>
                        </div>
                        <div id="all-appointments-content" class="table-body hidden"></div>
                        <div id="all-appointments-error" class="error-message hidden"></div>
                    </div>
                </div>
            </div>

            <div id="panel-availability" class="panel hidden">
                <div class="card">
                    <div class="section-header">
                        <h1>L·ªãch l√†m vi·ªác</h1>
                        <div>
                            <a href="#" id="btn-refresh-avail" class="btn-secondary btn-small">L√†m m·ªõi</a>
                        </div>
                    </div>

                    <div class="card-section">
                        <h2>Th√™m / C·∫≠p nh·∫≠t th·ªùi gian l√†m vi·ªác</h2>
                        <form id="availability-form">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px">
                                <div class="filter-group">
                                    <label for="avail-weekday">Th·ª©</label>
                                    <select id="avail-weekday" required>
                                        <option value="0">Th·ª© Hai</option>
                                        <option value="1">Th·ª© Ba</option>
                                        <option value="2">Th·ª© T∆∞</option>
                                        <option value="3">Th·ª© NƒÉm</option>
                                        <option value="4">Th·ª© S√°u</option>
                                        <option value="5">Th·ª© B·∫£y</option>
                                        <option value="6">Ch·ªß Nh·∫≠t</option>
                                    </select>
                                </div>

                                <div class="filter-group">
                                    <label>B·∫Øt ƒë·∫ßu</label>
                                    <input id="avail-start" placeholder="07:00" required />
                                </div>

                                <div class="filter-group">
                                    <label>K·∫øt th√∫c</label>
                                    <input id="avail-end" placeholder="11:00" required />
                                </div>

                                <div class="filter-group">
                                    <label>Slot (ph√∫t)</label>
                                    <input type="number" id="avail-slot" value="30" min="5" />
                                </div>
                            </div>

                            <div style="display: flex; justify-content: flex-end; margin-top: 1rem">
                                <button class="btn-primary" id="btn-add-availability">Th√™m / C·∫≠p nh·∫≠t</button>
                            </div>
                        </form>
                    </div>

                    <div class="card-section">
                        <h2>L·ªãch l√†m vi·ªác hi·ªán t·∫°i</h2>
                        <div id="availability-list" class="table table-availability">
                            <div class="row header">
                                <div>Ng√†y</div>
                                <div>Ca</div>
                                <div>B·∫Øt ƒë·∫ßu</div>
                                <div>K·∫øt th√∫c</div>
                                <div>Slot</div>
                                <div>Tr·∫°ng th√°i</div>
                                <div>Thao t√°c</div>
                            </div>
                            <div id="availability-loading" class="skeleton-table">
                                <div class="row shimmer">
                                    <div></div>
                                    <div></div>
                                    <div></div>
                                    <div></div>
                                    <div></div>
                                </div>
                            </div>
                            <div id="availability-content" class="table-body hidden"></div>
                            <div id="availability-error" class="error-message hidden"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="panel-days-off" class="panel hidden">
                <div class="card">
                    <div class="section-header">
                        <h1>Ng√†y ngh·ªâ</h1>
                        <div>
                            <a href="#" id="btn-refresh-days-off" class="btn-secondary btn-small">L√†m m·ªõi</a>
                        </div>
                    </div>

                    <div class="card-section">
                        <h2>Th√™m ng√†y ngh·ªâ</h2>
                        <form id="dayoff-form" class="dayoff-form">
                            <div class="row">
                                <div class="filter-group">
                                    <label for="dayoff-date">Ng√†y</label>
                                    <input type="text" id="dayoff-date" placeholder="dd / mm / yyyy" required />
                                </div>

                                <div class="filter-group">
                                    <label for="dayoff-start">B·∫Øt ƒë·∫ßu</label>
                                    <input type="text" id="dayoff-start" placeholder="07:00" />
                                </div>

                                <div class="filter-group">
                                    <label for="dayoff-end">K·∫øt th√∫c</label>
                                    <input type="text" id="dayoff-end" placeholder="11:00" />
                                </div>
                            </div>

                            <div class="row">
                                <div class="filter-group" style="flex: 1">
                                    <label for="dayoff-reason">L√Ω do</label>
                                    <input type="text" id="dayoff-reason" placeholder="V√≠ d·ª•: ngh·ªâ ·ªëm, c√¥ng t√°c..." />
                                </div>
                            </div>

                            <div class="row" style="justify-content: flex-end">
                                <button type="submit" class="btn-primary" id="btn-add-dayoff">Th√™m ng√†y ngh·ªâ</button>
                            </div>
                        </form>
                    </div>

                    <div class="card-section">
                        <h2>Danh s√°ch ng√†y ngh·ªâ</h2>
                        <div id="days-off-list" class="table">
                            <div class="row header">
                                <div>Ng√†y</div>
                                <div>Th·ªùi gian</div>
                                <div>L√Ω do</div>
                                <div>Thao t√°c</div>
                            </div>
                            <div id="days-off-loading" class="skeleton-table">
                                <div class="row shimmer">
                                    <div></div>
                                    <div></div>
                                    <div></div>
                                    <div></div>
                                </div>
                            </div>
                            <div id="days-off-content" class="table-body hidden"></div>
                            <div id="days-off-error" class="error-message hidden"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="panel-notifications" class="panel hidden">
                <div class="card">
                    <div class="section-header">
                        <h1>Th√¥ng b√°o</h1>
                        <a href="#" class="btn-secondary btn-small" id="btn-refresh-notifications">L√†m m·ªõi</a>
                    </div>
                    <div id="notifications-table" class="table">
                        <div class="row header">
                            <div>N·ªôi dung</div>
                            <div>Th·ªùi gian</div>
                            <div>Lo·∫°i</div>
                            <div>Tr·∫°ng th√°i</div>
                        </div>
                        <div id="notifications-loading" class="skeleton-table">
                            <div class="row shimmer">
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                            </div>
                            <div class="row shimmer">
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                            </div>
                        </div>
                        <div id="notifications-content" class="table-body hidden"></div>
                        <div id="notifications-error" class="error-message hidden"></div>
                    </div>
                </div>
            </div>

            <div id="panel-stats" class="panel hidden">
                <div class="card">
                    <h1>Th·ªëng k√™</h1>
                    <div id="stats-full" class="stats-grid">
                        <div class="bar w-75 shimmer"></div>
                        <div class="bar w-60 shimmer"></div>
                        <div class="bar w-50 shimmer"></div>
                    </div>
                    <div id="stats-error" class="error-message hidden"></div>
                </div>
            </div>

            <div id="panel-messages" class="panel hidden">
                <div class="card">
                    <h1>Tin nh·∫Øn</h1>
                    <p>Ch·ª©c nƒÉng ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn...</p>
                </div>
            </div>

            <div id="loadingOverlay" class="loading-overlay">
                <div class="spinner"></div>
                <div class="loading-text">ƒêang x·ª≠ l√Ω...</div>
                <div class="loading-subtext">Qu√° tr√¨nh n√†y c√≥ th·ªÉ m·∫•t m·ªôt ch√∫t th·ªùi gian.</div>
            </div>

            <div id="ToastContainer" class="toast-container"></div>
        </section>

        <div id="cancelModal" class="modal" style="display: none">
            <div class="modal-content">
                <h2>X√°c nh·∫≠n h·ªßy l·ªãch h·∫πn</h2>
                <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën h·ªßy l·ªãch h·∫πn n√†y kh√¥ng?</p>
                <div class="modal-actions">
                    <button id="cancelConfirmBtn" class="btn-cancel">H·ªßy</button>
                    <button id="cancelCloseBtn" class="btn-close">ƒê√≥ng</button>
                </div>
            </div>
        </div>

        <div id="deleteModal" class="modal" style="display: none">
            <div class="modal-content">
                <h2>X√°c nh·∫≠n x√≥a l·ªãch l√†m vi·ªác</h2>
                <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a l·ªãch l√†m vi·ªác n√†y kh√¥ng?</p>
                <div class="modal-actions">
                    <button id="deleteConfirmBtn" class="btn-cancel">X√≥a</button>
                    <button id="deleteCloseBtn" class="btn-close">ƒê√≥ng</button>
                </div>
            </div>
        </div>

        <div id="errorModal" class="modal" style="display: none">
            <div class="modal-content">
                <h2>Th√¥ng b√°o</h2>
                <p id="errorModalMessage"></p>
                <div class="modal-actions">
                    <button id="errorModalCloseBtn" class="btn-close">ƒê√≥ng</button>
                </div>
            </div>
        </div>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/vn.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script type="module" src="{% static 'js/dashboard/doctor/doctor-dashboard.js' %}"></script>
{% endblock %}
