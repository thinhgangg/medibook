{% extends "base.html" %}
{% load static %}
{% block content %}

<link rel="stylesheet" href="{% static 'css/login.css' %}?v=7" />

<div class="auth-container">
    <div class="form-container">
        <div class="tabs">
            <a href="?action=login" class="tab {% if action == 'login' %}active{% endif %}">Đăng nhập</a>
            <a href="?action=register" class="tab {% if action == 'register' %}active{% endif %}">Đăng ký</a>
        </div>
        <!-- Login form -->
        <div id="login" class="tab-content {% if action != 'login' %}hidden{% endif %}">
            <form id="login-form">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="email" placeholder="Nhập email của bạn" required class="input-field" data-validate="email" />
                    <span class="error" id="email-error"></span>
                </div>
                <div class="form-group">
                    <label>Mật khẩu</label>
                    <input type="password" name="password" placeholder="Nhập mật khẩu" required class="input-field" data-validate="password" />
                    <span class="error" id="password-error"></span>
                </div>
                <div class="form-row">
                    <div class="checkbox">
                        <input type="checkbox" id="remember" />
                        <label for="remember">Nhớ mật khẩu</label>
                    </div>
                    <div class="forgot-password">
                        <a href="{% url 'accounts:forgot_password' %}">Quên mật khẩu?</a>
                    </div>
                </div>
                <button type="submit" class="btn-submit">Đăng nhập</button>
                <div class="divider-with-text">
                    <span class="divider-text">
                        Chưa có tài khoản?
                        <a href="{% url 'accounts:login' %}?action=register" class="link">Đăng ký ngay</a>
                    </span>
                </div>
            </form>
        </div>

        <!-- Register form -->
        <div id="register" class="tab-content {% if action != 'register' %}hidden{% endif %}">
            <form id="register-form">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="email" placeholder="Nhập email của bạn" required class="input-field" data-validate="email" />
                    <span class="error" id="reg-email-error"></span>
                </div>
                <div class="form-row">
                    <div class="checkbox">
                        <input type="checkbox" id="terms" required />
                        <label for="terms">Tôi đồng ý với các điều khoản và điều kiện sử dụng</label>
                    </div>
                </div>
                <button type="button" id="send-otp" class="btn-submit" disabled>Gửi OTP</button>
                <div class="divider-with-text">
                    <span class="divider-text">
                        Đã có tài khoản?
                        <a href="{% url 'accounts:login' %}?action=login" class="link">Đăng nhập</a>
                    </span>
                </div>
            </form>
        </div>
    </div>

    <div class="register-flow hidden">
        <div class="container">
            <div class="steps">
                <div class="step active" data-step="1">1. Xác thực</div>
                <div class="step" data-step="2">2. Mật khẩu</div>
                <div class="step" data-step="3">3. Tạo hồ sơ</div>
            </div>

            <!-- Step 1: OTP -->
            <div id="otp-section" class="step-content" data-step="1">  <!-- Loại bỏ hidden để JS xử lý -->
                <p class="otp-info">Nhập mã OTP vừa được gửi đến <span id="user-email"></span></p>
                <div class="otp-input">
                    <input type="text" name="otp" maxlength="6" placeholder="Nhập mã OTP" class="input-field" data-validate="otp" />
                    <span class="error" id="otp-error"></span>
                </div>
                <button type="button" id="verify-otp" class="btn-primary">Tiếp tục</button>
                <p class="resend">
                    Không nhận được mã OTP? <br />
                    <a href="#" id="resend-otp">Thử lại</a>
                    <span id="countdown"></span>
                </p>
            </div>

            <!-- Step 2: Password -->
            <div id="password-section" class="step-content hidden" data-step="2">
                <form id="password-form">
                    <div class="form-group">
                        <label>Mật khẩu</label>
                        <input type="password" name="password" placeholder="Nhập mật khẩu" required class="input-field" data-validate="password" />
                        <span class="error" id="pass-error"></span>
                    </div>
                    <div class="form-group">
                        <label>Xác nhận mật khẩu</label>
                        <input type="password" name="confirm_password" placeholder="Xác nhận mật khẩu" required class="input-field" data-validate="confirm-password" />
                        <span class="error" id="confirm-pass-error"></span>
                    </div>
                    <button type="button" id="set-password" class="btn-primary">Tiếp tục</button>
                </form>
            </div>

            <!-- Step 3: Profile - Xóa phần form-step trùng lặp -->
            <div id="profile-section" class="step-content hidden" data-step="3">
                <form id="profile-form" class="profile-grid">
                    <!-- Cột trái -->
                    <div class="form-group">
                        <label>Họ và tên <span class="required">*</span></label>
                        <input type="text" name="full_name" placeholder="Nhập họ và tên" required class="input-field" data-validate="text" />
                        <span class="error" id="full-name-error"></span>
                    </div>
                    <div class="form-group">
                        <label>Số điện thoại <span class="required">*</span></label>
                        <input type="tel" name="phone_number" placeholder="Nhập số điện thoại" required class="input-field" data-validate="phone" />
                        <span class="error" id="phone-error"></span>
                    </div>
                    <div class="form-group">
                        <label>Ngày sinh <span class="required">*</span></label>
                        <input type="date" name="dob" required class="input-field" data-validate="date" />
                        <span class="error" id="dob-error"></span>
                    </div>
                    <div class="form-group gender-group">
                        <label>Giới tính</label>
                        <div class="radio-group two-columns">
                            <div class="gender-column">
                                <input type="radio" name="gender" value="MALE" checked />
                                <label>Nam</label>
                            </div>
                            <div class="gender-column">
                                <input type="radio" name="gender" value="FEMALE" />
                                <label>Nữ</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Số CMND/CCCD</label>
                        <input type="text" name="id_number" placeholder="Số CMND/CCCD" class="input-field" data-validate="id" />
                        <span class="error" id="id-error"></span>
                    </div>
                    <div class="form-group">
                        <label>Dân tộc</label>  
                        <input type="text" name="ethnicity" placeholder="Nhập dân tộc" class="input-field" data-validate="text" />
                        <span class="error" id="ethnicity-error"></span>
                    </div>

                    <!-- Cột phải -->
                    <div class="form-group">
                        <label>Mã thẻ bảo hiểm y tế</label>
                        <input type="text" name="insurance_no" placeholder="Mã số BHYT" class="input-field" data-validate="text" />
                        <span class="error" id="insurance-error"></span>
                    </div>
                    <div class="form-group">
                        <label for="city">Tỉnh / Thành phố</label>
                        <select id="city" name="city" required class="input-field select-field" data-validate="select">
                            <option value="">-- Chọn Tỉnh / Thành phố --</option>
                        </select>
                        <span class="error" id="city-error"></span>
                    </div>
                    <div class="form-group">
                        <label for="district">Quận / Huyện</label>
                        <select id="district" name="district" required class="input-field select-field" data-validate="select">
                            <option value="">-- Chọn Quận / Huyện --</option>
                        </select>
                        <span class="error" id="district-error"></span>
                    </div>
                    <div class="form-group">
                        <label for="ward">Phường / Xã</label>
                        <select id="ward" name="ward" required class="input-field select-field" data-validate="select">
                            <option value="">-- Chọn Phường / Xã --</option>
                        </select>
                        <span class="error" id="ward-error"></span>
                    </div>
                    <div class="form-group">
                        <label>Địa chỉ cụ thể</label>
                        <input type="text" name="address_detail" placeholder="Số nhà, tên đường" class="input-field" data-validate="text" />
                        <span class="error" id="address-error"></span>
                    </div>
                    <div class="form-group">
                        <label>Nghề nghiệp</label>
                        <input type="text" name="occupation" placeholder="Nhập nghề nghiệp" class="input-field" data-validate="text" />
                        <span class="error" id="occupation-error"></span>
                    </div>
                </form>
                <div class="form-actions">
                    <button type="button" id="submit-profile" class="btn-primary">Hoàn tất</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="{% static 'js/login.js' %}"></script>
{% endblock content %}